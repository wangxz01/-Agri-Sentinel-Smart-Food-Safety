*{box-sizing:border-box}
html,body{height:100%}
:root{--bg:#0a192f;--card:#112240;--text:#ccd6f6;--accent:#64ffda;--border:#1a3a5e;--space-1:8px;--space-2:12px;--space-3:16px;--space-4:20px;--header-h:64px}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans",sans-serif;background:radial-gradient(1200px 600px at 20% -10%,#0d1e33 0%,#0a192f 40%,#081526 100%),#0a192f;color:var(--text)}
header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:#0d1e33;border-bottom:1px solid var(--border);box-shadow:0 1px 0 rgba(100,255,218,.25) inset;gap:8px}
header h1{margin:0;font-size:20px;letter-spacing:.6px;color:var(--text);display:flex;align-items:center;gap:10px}
.subtitle-en{font-size:13px;color:#9fb3d1;opacity:.9}
#fit-btn,#simulate-btn{appearance:none;border:1px solid var(--accent);background:var(--card);color:var(--accent);padding:8px 12px;border-radius:8px;cursor:pointer}
#fit-btn:hover,#simulate-btn:hover{background:#133254}
.main-container{display:flex;height:calc(100vh - var(--header-h));overflow:hidden}
.left-panel{flex:0 0 30%;min-width:300px;border-right:1px solid var(--border);display:flex;flex-direction:column;padding:var(--space-3);gap:var(--space-3);background:#0e213a}
.right-panel{flex:0 0 70%;display:flex;padding:var(--space-3)}
.kpi-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--space-2)}
.kpi-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;display:flex;flex-direction:column;gap:6px}
.kpi-title{font-size:12px;color:#9fb3d1}
.kpi-value{font-size:26px;font-weight:700;color:var(--accent)}
.kpi-trend{margin-top:6px;display:flex;align-items:center;gap:8px}
.kpi-trend svg{width:100%;height:24px;opacity:.9}
.kpi-delta{font-size:12px;color:#9fb3d1}
.event-log{flex:1;display:flex;flex-direction:column;background:var(--card);border:1px solid var(--border);border-radius:12px;min-height:0}
.event-log-header{padding:10px 12px;border-bottom:1px solid var(--border);color:#9fb3d1;font-size:13px}
.event-list{list-style:none;margin:0;padding:10px 12px;overflow:auto;flex:1;overscroll-behavior:contain}
.event-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-bottom:1px dashed var(--border);gap:8px}
.event-item:last-child{border-bottom:0}
.event-badge{font-size:11px;padding:4px 8px;border-radius:999px;background:var(--accent);color:#0a192f;border:1px solid var(--accent)}
.event-badge.level-1{background:#f97583;border-color:#f97583;color:#0a192f}
.event-badge.level-2{background:#ffb86b;border-color:#ffb86b;color:#0a192f}
.event-badge.level-3{background:#ffd166;border-color:#ffd166;color:#0a192f}
.event-time{font-size:11px;color:#9fb3d1;margin-left:auto}
.map-container{width:100%;flex:1;min-height:80vh;height:100%;background:radial-gradient(ellipse at center,#122a47 0%,#0a192f 60%,#081526 100%);border:1px solid var(--border);border-radius:12px;position:relative;overflow:hidden}
.map-title{position:absolute;top:12px;left:16px;color:#9fb3d1;font-size:13px}
.map-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(100,255,218,.06) 1px,transparent 1px),linear-gradient(90deg,rgba(100,255,218,.06) 1px,transparent 1px);background-size:32px 32px}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:1000}
.modal.visible,.modal.active{display:flex}
.modal-card{width:min(560px,92vw);background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,.45);padding:18px;display:flex;flex-direction:column;gap:12px}
.modal-header{display:flex;align-items:center;justify-content:space-between}
.modal-title{font-size:16px;color:var(--accent)}
.close-btn{appearance:none;border:1px solid var(--border);background:#133254;color:var(--text);padding:6px 10px;border-radius:8px;cursor:pointer}
.close-btn:hover{background:#164069}
.modal-content{color:var(--text);font-size:14px;line-height:1.6}
.timeline{position:relative;padding-left:18px;display:flex;flex-direction:column;gap:10px}
.timeline:before{content:"";position:absolute;left:8px;top:0;bottom:0;width:2px;background:rgba(100,255,218,.3)}
.timeline-item{position:relative;display:flex;align-items:flex-start;gap:10px}
.timeline-dot{position:absolute;left:3px;top:2px;width:10px;height:10px;border-radius:50%;background:#64ffda;border:2px solid #0a192f;box-shadow:0 0 0 2px rgba(100,255,218,.2)}
.timeline-content{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:8px 10px;color:var(--text)}
.actions{display:flex;gap:8px}
.action{appearance:none;border:1px solid var(--accent);background:var(--card);color:var(--accent);padding:8px 12px;border-radius:8px;cursor:pointer}
.action:hover{background:#133254}
.high-risk-alert{border:2px solid #f97583;animation:flash 1s infinite}
@keyframes flash{0%{box-shadow:0 0 0 0 rgba(249,117,131,.8)}50%{box-shadow:0 0 12px 2px rgba(249,117,131,.8)}100%{box-shadow:0 0 0 0 rgba(249,117,131,.8)}}
.alert-pulse{animation:pulseRing 1.6s infinite ease-out;stroke:#f97583;fill:transparent}
@keyframes pulseRing{0%{stroke-opacity:.9;stroke-width:1}60%{stroke-opacity:.35;stroke-width:4}100%{stroke-opacity:0;stroke-width:6}}
.leaflet-pane .marker-safe{filter:drop-shadow(0 0 6px rgba(100,255,218,.35))}